- is_collapsed = local_assigns.fetch(:is_collapsed, false)
- todo = issuable_sidebar[:todo] || {}

- todo_text = _('Add todo')
- mark_text = _('Mark todo as done')
- todo_icon = sprite_icon('todo-add')
- mark_icon = sprite_icon('todo-done', css_class: 'todo-undone')

- mark_content = is_collapsed ? mark_icon : mark_text
- todo_content = is_collapsed ? todo_icon : todo_text

%button.issuable-todo-btn.js-issuable-todo{ type: 'button',
  class: (is_collapsed ? 'btn-blank sidebar-collapsed-icon dont-change-state has-tooltip' : 'btn btn-default issuable-header-btn float-right'),
  title: (todo[:id] ? mark_text : todo_text),
  'aria-label' => (todo[:id] ? mark_text : todo_text),
  data: { todo_text: todo_text,
    mark_text: mark_text,
    todo_icon: is_collapsed ? todo_icon : nil,
    mark_icon: is_collapsed ? mark_icon : nil,
    issuable_id: issuable_sidebar[:id],
    issuable_type: issuable_sidebar[:type],
    create_path: issuable_sidebar[:create_todo_path],
    delete_path: todo[:delete_path] } }
  %span.issuable-todo-inner.js-issuable-todo-inner<
    - if todo[:id]
      = mark_content
    - else
      = todo_content
  = icon('spin spinner', 'aria-hidden': 'true')
